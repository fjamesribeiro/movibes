{% extends "base.html" %}
{% load static %}

{% block content %}
<!-- Hero Section-->
<section class="overflow-hidden relative h-[550px] flex items-center bg-cover bg-center shadow-5xl" style="background-image: url('{% static 'images/hero-bg.jpg' %}'); background-size: cover; background-position: center;">
    <div class="absolute inset-0 bg-gradient-to-r from-black/70 via-black/50 to-transparent"></div>

    <div class="relative z-10 px-12 md:px-16 py-20 max-w-3xl">
        <h1 class="text-4xl md:text-5xl lg:text-6xl font-bold leading-tight mb-8">
            Bem-vindo(a) a sua nova plataforma de
            <span class="text-yellow-400">Conexão por estilo</span>
        </h1>

        <p class="text-lg md:text-xl text-white font-bold mb-12">
            Criamos conexões através do estilo de vida
        </p>

        <div class="flex flex-wrap gap-5">
            <a href="{% url 'account_signup' %}"
               class="inline-flex items-center bg-yellow-400 text-black font-bold px-8 py-3 rounded-lg text-base hover:bg-yellow-500 transition-all transform hover:scale-105 shadow-lg">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"/>
                </svg>
                Criar perfil Profissional
            </a>
            <a href="#eventos"
               class="inline-flex items-center bg-white/10 backdrop-blur-sm text-white font-bold px-8 py-3 rounded-lg text-base hover:bg-white/20 transition-all transform hover:scale-105 border border-white/30">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                </svg>
                Ver eventos
            </a>
        </div>
    </div>
</section>

<!-- Seção Principal de Eventos -->
<section class="py-12 md:py-12 px-4 md:px-6 lg:px-8" id="eventos">
    <div class="max-w-7xl mx-auto">
        <!-- Título centralizado -->
        <div class="text-center mb-8 md:mb-10">
            <h3 class="text-4xl md:text-5xl font-bold mb-4">
                Próximos eventos, <span class="text-yellow-400">agendados</span>
            </h3>
            <p class="text-gray-300 text-lg md:text-xl">
                Aqui é vida real. Encontre treinos e atividades para sair de casa, treinar e fazer conexões
            </p>
        </div>

        <!-- Busca e Filtros -->
        <div class="mb-10 space-y-6 px-4 md:px-0">

            <!-- Busca por nome -->
            <div class="flex justify-center">
                <div class="relative w-full max-w-md">
                    <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-500 pointer-events-none z-10" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                    </svg>
                    <input
                        type="text"
                        id="search-input"
                        placeholder="Buscar eventos..."
                        class="w-full py-3 pl-10 pr-4 bg-gray-800 border-2 border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-yellow-400 focus:ring-2 focus:ring-yellow-400/20 transition-all"
                        hx-get="{% url 'home' %}"
                        hx-trigger="keyup changed delay:500ms"
                        hx-target="#eventos-list"
                        hx-include="[name='categoria']"
                        hx-indicator="#loading"
                        name="search">
                </div>
            </div>

            <!-- Filtro de Categorias -->
            <div x-data="{ showAll: false }" class="px-0">
                <div class="flex items-center justify-between mb-4">
                    <h4 class="text-base font-semibold text-white flex items-center">
                        <svg class="w-5 h-5 mr-2 text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"/>
                        </svg>
                        Filtrar por Categoria
                    </h4>

                    <!-- Limpar filtros -->
                    <button
                        hx-get="{% url 'home' %}"
                        hx-target="#eventos-list"
                        hx-indicator="#loading"
                        onclick="document.getElementById('search-input').value = ''"
                        class="text-sm text-gray-400 hover:text-yellow-400 transition-colors flex items-center">
                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                        </svg>
                        Limpar filtros
                    </button>
                </div>

                <!-- Container de categorias -->
                <div class="relative">
                    <div class="absolute right-0 top-0 bottom-0 w-12 bg-gradient-to-l from-[#111827] to-transparent pointer-events-none z-10 hidden md:block" x-show="!showAll"></div>

                    <div class="flex gap-3 overflow-x-auto pb-4 scrollbar-hide -mx-4 px-4 md:mx-0 md:px-0" :class="{ 'flex-wrap': showAll }">
                        <!-- Botão "Todos" -->
                        <button
                            hx-get="{% url 'home' %}"
                            hx-target="#eventos-list"
                            hx-include="#search-input"
                            hx-indicator="#loading"
                            class="category-btn flex-shrink-0 px-5 py-2.5 bg-gray-800 hover:bg-yellow-400 text-white hover:text-black border-2 border-gray-700 hover:border-yellow-400 rounded-lg font-semibold transition-all transform hover:scale-105 whitespace-nowrap text-sm">
                            <span class="flex items-center">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"/>
                                </svg>
                                Todas
                            </span>
                        </button>

                        <!-- Loop de categorias -->
                        {% for categoria in categorias %}
                        <button
                            hx-get="{% url 'home' %}?categoria={{ categoria.id }}"
                            hx-target="#eventos-list"
                            hx-include="#search-input"
                            hx-indicator="#loading"
                            name="categoria"
                            value="{{ categoria.id }}"
                            class="category-btn flex-shrink-0 px-5 py-2.5 bg-gray-800 hover:bg-yellow-400 text-white hover:text-black border-2 border-gray-700 hover:border-yellow-400 rounded-lg font-semibold transition-all transform hover:scale-105 whitespace-nowrap text-sm group">
                            <span class="flex items-center">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"/>
                                </svg>
                                {{ categoria.nome }}
                                <span class="ml-2 text-xs bg-gray-700 group-hover:bg-black/30 px-2 py-0.5 rounded-full">
                                    {{ categoria.eventos_count|default:0 }}
                                </span>
                            </span>
                        </button>
                        {% endfor %}
                    </div>

                    <!-- Botão "Ver mais/menos" para mobile -->
                    <button
                        @click="showAll = !showAll"
                        class="mt-4 text-sm text-yellow-400 hover:text-yellow-300 font-semibold flex items-center md:hidden mx-auto">
                        <span x-text="showAll ? 'Ver menos' : 'Ver todas as categorias'"></span>
                        <svg class="w-4 h-4 ml-1 transition-transform" :class="{ 'rotate-180': showAll }" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Loading indicator -->
        <div id="loading" class="htmx-indicator flex justify-center items-center py-12">
            <div class="flex items-center space-x-2">
                <svg class="animate-spin h-8 w-8 text-yellow-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <span class="text-gray-400 font-semibold">Carregando eventos...</span>
            </div>
        </div>

        <!-- Lista de Eventos -->
        <section class="px-4 md:px-6 lg:px-8 pb-4 md:pb-6" id="eventos-list">
            {% include 'partials/eventos_list.html' %}
        </section>
    </div>
</section>

<!-- CSS adicional -->
<!-- CSS adicional -->
<style>
    /* Prevenir scroll horizontal da página inteira */
    body {
        overflow-x: hidden;
        max-width: 100vw;
    }

    /* Container principal sem overflow */
    .max-w-7xl {
        max-width: 80rem;
        overflow-x: hidden;
    }

    /* Esconder scrollbar mas manter funcionalidade */
    .scrollbar-hide::-webkit-scrollbar {
        display: none;
    }
    .scrollbar-hide {
        -ms-overflow-style: none;
        scrollbar-width: none;
        -webkit-overflow-scrolling: touch;
        scroll-snap-type: x proximity;
        scroll-behavior: smooth;
        overflow-y: hidden; /* IMPORTANTE: evita scroll vertical no container */
    }

    .category-btn {
        scroll-snap-align: start;
        flex: 0 0 auto; /* Garante que não encolham */
    }

    /* Loading indicator HTMX */
    .htmx-indicator {
        display: none;
    }
    .htmx-request .htmx-indicator {
        display: flex;
    }
    .htmx-request #eventos-list {
        opacity: 0.5;
    }

    /* Animação de entrada */
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    #eventos-list {
        animation: fadeIn 0.3s ease-out;
    }

    /* Ajustes mobile específicos */
    @media (max-width: 768px) {
        /* Garante que botões não quebrem */
        .category-btn {
            min-width: fit-content;
        }

        /* Remove transform scale no mobile para evitar bugs */
        .category-btn:active {
            transform: scale(0.98);
        }
    }
</style>

{% endblock %}
