{% extends "base.html" %}
{% load format_filters %}

{% block content %}

<div class="min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 py-12 px-4">
  <div class="max-w-3xl mx-auto">

    <div class="text-center mb-10">
      <h1 class="text-4xl font-bold text-white mb-3">
        Minhas Conexões
      </h1>
      <p class="text-gray-400 text-lg">
        Gerencie seus pedidos de conexão e veja os números que você recebeu.
      </p>
    </div>

    <div class="bg-gray-800/50 backdrop-blur border border-gray-700 rounded-2xl p-8 shadow-xl mb-8">
      <h2 class="text-2xl font-bold text-white mb-6">Pedidos Pendentes</h2>
      {% if not pedidos_pendentes %}
      <p class="text-gray-400">Você não tem nenhum pedido de conexão pendente.</p>
      {% else %}
      <div class="space-y-4">
        {% for sol in pedidos_pendentes %}
        <div class="flex items-center justify-between p-4 bg-gray-700/50 rounded-lg">
          <p class="text-white">
            <span class="font-semibold">{{ sol.solicitante.first_name }} {{ sol.solicitante.last_name }}</span>
            quer se conectar com você.
          </p>
          <div class="flex space-x-3">
            <form action="{% url 'responder_solicitacao' sol.id 'aceitar' %}" method="POST">
              {% csrf_token %}
              <button type="submit"
                      class="bg-green-600 text-white font-semibold px-4 py-2 rounded-lg text-sm hover:bg-green-700">
                Aceitar
              </button>
            </form>
            <form action="{% url 'responder_solicitacao' sol.id 'recusar' %}" method="POST">
              {% csrf_token %}
              <button type="submit"
                      class="bg-red-600 text-white font-semibold px-4 py-2 rounded-lg text-sm hover:bg-red-700">Recusar
              </button>
            </form>
          </div>
        </div>
        {% endfor %}
      </div>
      {% endif %}
    </div>

    <div class="bg-gray-800/50 backdrop-blur border border-gray-700 rounded-2xl p-8 shadow-xl mb-8">
      <h2 class="text-2xl font-bold text-white mb-6">Meus Contatos</h2>
      {% if not pedidos_aceitos_para_mim %}
      <p class="text-gray-400">Você ainda não tem conexões aceitas. Quando alguém aceitar seu pedido, o WhatsApp
        aparecerá aqui.</p>
      {% else %}
      <div class="space-y-4">
        {% for sol in pedidos_aceitos_para_mim %}
        <div class="p-4 bg-gray-700/50 rounded-lg
                                {% if sol.id in novos_pedidos_aceitos_ids %}
                                    border-2 border-yellow-400 shadow-lg
                                {% endif %}">
          <p class="text-white">
            <span class="font-semibold">{{ sol.solicitado.first_name }} {{ sol.solicitado.last_name }}</span>
            aceitou sua conexão
          </p>
          <p class="text-lg text-yellow-400 font-bold mt-2">
            WhatsApp: {{ sol.solicitado.whatsapp|format_phone }}
          </p>
        </div>
        {% endfor %}
      </div>
      {% endif %}
    </div>

  </div>
</div>
{% endblock %}
